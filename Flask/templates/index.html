<!DOCTYPE html>
<html>

<head>
  <title>PlantUs</title>
  <!--meta tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--//meta tags ends here-->
  <!--booststrap-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <!--//booststrap end-->

  <!-- font-awesome icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw=="
    crossorigin="anonymous" />
  <!-- //font-awesome icons -->

  <!--stylesheets-->
  <link href="../static/styles/style.css" rel='stylesheet' type='text/css' media="all">
  <!--//stylesheets-->
  <style>
    body {
      background-color:#e8cfa6;
    }
    .cell .red-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(255, 0, 0, 0.5); /* Red with 50% transparency */
  z-index: 3; /* Ensure itâ€™s above everything else */
  display: none;
}

   /* Field View Container */
#field-view,.blog_w3ls{
  margin: 20px auto;
  padding: 20px;
  max-width: 800px;
  border: none !important;
  border-radius: 15px;
  background-color: #7ca45c;
  color: rgb(255, 255, 255);
}

#field-view .controls {
  margin-bottom: 20px;
}

#field-view #grid {
  display: grid;
  gap: 5px;
  border: none !important;
}

/* Cell Styling */
#field-view .cell {
  width: 70px;
  height: 70px;
  border: 1px solid #ccc;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: relative; /* Required for layering */
  background-color: transparent; /* Ensure cell background is transparent */
}

/* Soil Image (Background) */
#field-view .cell .soil {
  width: 100%;
  height: 100%;
  position: absolute; /* Position soil image at the bottom */
  top: 0;
  left: 0;
  z-index: 1; /* Soil image is below the plant image */
  object-fit: cover; /* Ensure the soil image covers the cell */
}

/* Plant Image (Foreground) */
#field-view .cell .plant {
  width: 100%;
  height: 100%;
  position: absolute; /* Position plant image on top */
  top: 0;
  left: 0;
  z-index: 2; /* Plant image is above the soil image */
  object-fit: contain; /* Ensure the plant image fits inside the cell */
  background-color: transparent; /* Ensure plant image background is transparent */

}
.garden-planner-heading {
    color: white;
    font-size: 2.2em;
    text-align: center;
  }
  /* Custom styles for the file input and button */
#test .btn-primary {
  background-color: #28a745; /* Green color */
  border-color: #28a745;
  font-size: 1.1em;
  padding: 10px 20px;
  transition: background-color 0.3s ease;
}

#test .btn-primary:hover {
  background-color: #218838; /* Darker green on hover */
  border-color: #1e7e34;
}

#test .btn-success {
  background-color: #007bff; /* Blue color */
  border-color: #007bff;
  font-size: 1.1em;
  padding: 10px 20px;
  transition: background-color 0.3s ease;
}

#test .btn-success:hover {
  background-color: #0056b3; /* Darker blue on hover */
  border-color: #004085;
}

#test .bg-light {
  background-color: #f8f9fa !important; /* Light background for the form */
}

#test .rounded {
  border-radius: 10px !important; /* Rounded corners */
}

#test .shadow {
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow */
}

#test .garden-planner-heading {
  color: white;
  font-size: 2.2em;
  text-align: center;
  margin-bottom: 20px;
}

#test #imagePreview {
  display: none; /* Hide initially */
}

#test #imagePreview img {
  border: 2px solid #ddd; /* Border for the preview image */
}
  </style>
</head>

<body>
  <div class="main-top" id="home">
    <!-- header -->
    <div class="headder-top">
      <!-- nav -->
      <nav>
        <div id="logo">
          <h1><a href="index.html">PlantUs</a></h1>
        </div>
        <label for="drop" class="toggle">Menu</label>
        <input type="checkbox" id="drop">
        <ul class="menu mt-2">
          <li class="active"><a href="#home">Home</a></li>
          <li><a href="#field-view">Garden</a></li>
          <li><a href="#test">Test</a></li>
          <li><a id="increment-item" href="#new-section"><img src="../static/images/tomato.png" alt="X 0" style="width: 60px; height: 60px;"> X <span id="increment-value">0</span></a></li>
        </ul>
      </nav>
      <!-- //nav -->
    </div>
    <!-- //header -->
    <!-- banner -->
    <div class="main-banner text-center">
      <div class="container">
        <div class="style-banner">
          <h4 class="mb-2">PlantUs</h4>
          <h5>Smart Crop Monitoring for Farms and Communities
          </h5>
        </div>
      </div>
    </div>
  </div>
  <!-- //banner -->
    <!-- Field View Section -->
    <section id="field-view">
      <div class="controls">
        <h4 class="mb-2 garden-planner-heading">Garden Planner</h4>

        <button id="add-row">Add Row</button>
        <button id="add-col">Add Column</button>
        <select id="plant-select">
          <option value="">Select a Plant</option>
          <option value="tomato">Tomato</option>
          <option value="carrot">Carrot</option>
          <option value="wheat">Wheat</option>
          <option value="flower">Flower</option>
          <option value="apple">Apple</option>
          <option value="corn">Corn</option>
        </select>
      </div>
      <div id="grid"></div>
    </section>
    <!-- //Field View Section -->
<!-- Modal Structure for Plant Info -->
<div class="modal fade" id="plantInfoModal" tabindex="-1" role="dialog" aria-labelledby="plantInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="plantInfoModalLabel">Plant Information</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="water-row">
          <span>Water</span>
          <span class="circle water-circle"></span>
          <span class="circle water-circle"></span>
          <span class="circle water-circle"></span>
        </div>
        <div class="water-row">
          <span>Soil</span>
          <span class="circle soil-circle"></span>
          <span class="circle soil-circle"></span>
          <span class="circle soil-circle"></span>
        </div>
        <div class="water-row">
          <span>Health</span>
          <span class="circle health-circle"></span>
          <span class="circle health-circle"></span>
          <span class="circle health-circle"></span>
        </div>
        <div id="plantInfoContent">
          <!-- Plant information will be displayed here -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal Structure -->
<div class="modal fade" id="resultModal" tabindex="-1" role="dialog" aria-labelledby="resultModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="resultModalLabel">Prediction Result</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="resultContent">
        <!-- Result will be displayed here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="actionButton">Take Action</button>
      </div>
    </div>
  </div>
</div>
<!-- Test Your Plants Section -->
<section class="blog_w3ls py-5" id="test">
  <div class="container pb-xl-5 pb-lg-3">
    <h4 class="garden-planner-heading">Test Your Plants</h4>
    <div class="row justify-content-center">
      <div class="col-md-6 text-center">
        <form id="predictForm" enctype="multipart/form-data" class="p-4 bg-light rounded shadow">
          <div class="form-group">
            <label for="inputImage" class="btn btn-custom2 btn-block">
              <i class="fa fa-upload mr-2"></i> Choose File
              <input type="file" name="file" id="inputImage" onchange="previewImage(event)" style="display: none;" required>
            </label>
          </div>
          <div class="form-group">
            <button class="btn btn-custom1 btn-block" type="submit">
              <i class="fa fa-magic mr-2"></i> Predict
            </button>
          </div>
          <div id="imagePreview" class="mt-3">
            <img id="output-image" class="img-fluid rounded" style="max-height: 200px;" />
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

  <!-- footer -->
  <footer>
    <div class="container pt-5 pb-3">
      <div class="footer-w3layouts-head text-center">
        <h2><a href="index.html">PlantUs</a></h2>
      </div>
      <div class="bottem-wthree-footer text-center pt-md-4 pt-3">
        <p>
          PolyHacks 2025
        </p>
      </div>
      <!-- move icon -->
      <div class="text-center">
        <a href="#home" class="move-top text-center mt-3"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
      </div>
      <!--//move icon -->
    </div>
  </footer>
  <!--//footer -->

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
    <script>

    // Define the action_taken variable
    let action_taken = false;

    // Function to increment the value
    function incrementValue() {
    const valueElement = document.getElementById('increment-value');
    let currentValue = parseInt(valueElement.textContent);
    currentValue++;
    valueElement.textContent = currentValue;
  }
     // Function to add the overlay
  function addOverlay() {
    const firstCell = document.querySelector('#grid .cell:first-child');
    if (firstCell) {
      // Create a red overlay div
      const overlay = document.createElement('div');
      overlay.id = 'red-overlay'; // Add an id to the overlay
      overlay.style.position = 'absolute';
      overlay.style.top = '0';
      overlay.style.left = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.backgroundColor = 'rgba(255, 0, 0, 0.5)'; // Red with transparency
      overlay.style.zIndex = '3'; // Ensure it's on top

      // Add the overlay to the cell
      firstCell.appendChild(overlay);
    }
  }

  // Function to remove the overlay
  function removeOverlay() {
    const overlay = document.getElementById('red-overlay');
    if (overlay) {
      overlay.remove();
    }
  }

  // Set action_taken to false when the modal is opened
  $('#resultModal').on('show.bs.modal', function () {
    action_taken = false;
  });

  // Add a red transparent layer to the first grid cell when the modal is closed
  $('#resultModal').on('hidden.bs.modal', function () {
    if (!action_taken) {
      addOverlay();
    }
  });
    
      // Handle form submission
      document.getElementById('predictForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(this);
    
        fetch("{{ url_for('predict') }}", {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === 200) {
            // Display result in modal
            document.getElementById('resultContent').innerHTML = data.result;
            $('#resultModal').modal('show');
          } else {
            alert(data.result);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred while processing your request.');
        });
      });
    
      // Handle action button click
      document.getElementById('actionButton').addEventListener('click', function() {
      action_taken = true;
      // Remove the overlay
      removeOverlay();
      // Call incrementValue after 5 seconds
      setTimeout(incrementValue, 5000);
      // Close the modal
      $('#resultModal').modal('hide');
      });
    
      // Field View Script
      const grid = document.getElementById('grid');
      const addRowButton = document.getElementById('add-row');
      const addColButton = document.getElementById('add-col');
      const plantSelect = document.getElementById('plant-select');
      const plantImages = {
        tomato: "../static/images/tomato.png",
        carrot: "../static/images/carrot.png",
        wheat: "../static/images/wheat.png",
        corn: "../static/images/corn.png",
        flower: "../static/images/flower.png",
        apple: "../static/images/apple.png",
      };
      const plantInfo = {
        tomato: "Tomato: A red, juicy fruit often used in salads and cooking.",
        carrot: "Carrot: An orange root vegetable that is crunchy and sweet.",
        wheat: "Wheat: A cereal grain used to make flour for bread, pasta, and more.",
        corn: "Corn: A yellow grain that is a staple food in many parts of the world.",
        flower: "Flower: A beautiful plant part that is often colorful and fragrant.",
        apple: "Apple: A sweet, edible fruit that comes in many varieties."
      };
      const initialGridState = [
        ['wheat', null, 'tomato', null, 'wheat',null],
        ['corn', null, 'flower', null, 'apple', null],
        [null, 'tomato', null, 'carrot', null, 'wheat'],
        ['corn', null, 'flower', null, 'apple', null],
        [null, 'tomato', null, 'carrot', null, 'wheat'],
        ['corn', null, 'flower', null, 'apple', null]
      ];
      let gridState = initialGridState;
      let rows = initialGridState.length;
      let cols = initialGridState[0].length;
    
      // Soil image path
      const soilImage = "../static/images/soil.png";
    
      // Function to create the grid
      function createGrid() {
        grid.innerHTML = ''; // Clear existing grid
        grid.style.gridTemplateColumns = `repeat(${cols}, 70px)`;
        grid.style.gridTemplateRows = `repeat(${rows}, 70px)`;
    
        for (let i = 0; i < rows; i++) {
          for (let j = 0; j < cols; j++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            cell.dataset.row = i;
            cell.dataset.col = j;
    
            // Add soil image to the cell
            const soilImg = document.createElement('img');
            soilImg.src = soilImage;
            soilImg.alt = "soil";
            soilImg.classList.add('soil');
            cell.appendChild(soilImg);
    
            // Add plant image placeholder
            const plantImg = document.createElement('img');
            plantImg.classList.add('plant');
    
            // If the cell has a plant, set its image
            if (gridState[i][j]) {
              plantImg.src = plantImages[gridState[i][j]];
              plantImg.alt = gridState[i][j];
            }
    
            cell.appendChild(plantImg);
    
            // Add click event to place the plant
            cell.addEventListener('click', () => {
              if (gridState[i][j]) {
                // Show plant info modal if the cell already has a plant
                document.getElementById('plantInfoContent').innerText = plantInfo[gridState[i][j]];
                $('#plantInfoModal').modal('show');
              } else {
                const selectedPlant = plantSelect.value;
                if (selectedPlant && plantImages[selectedPlant]) {
                  plantImg.src = plantImages[selectedPlant];
                  plantImg.alt = selectedPlant;
                  gridState[i][j] = selectedPlant; // Update the grid state
                  cell.classList.add('planted');
                }
              }
            });
    
            grid.appendChild(cell);
          }
        }
      }
    
      // Add row
      addRowButton.addEventListener('click', () => {
        rows++;
        // Add a new row to the grid state
        gridState.push(Array(cols).fill(null));
        createGrid();
      });
    
      // Add column
      addColButton.addEventListener('click', () => {
        cols++;
        // Add a new column to each row in the grid state
        gridState = gridState.map(row => [...row, null]);
        createGrid();
      });
    
      // Initialize grid
      createGrid();
      function previewImage(event) {
  const outputImage = document.getElementById('output-image');
  const imagePreview = document.getElementById('imagePreview');
  const file = event.target.files[0];

  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      outputImage.src = e.target.result;
      imagePreview.style.display = 'block'; // Show the preview
    };
    reader.readAsDataURL(file);
  } else {
    outputImage.src = '';
    imagePreview.style.display = 'none'; // Hide the preview if no file is selected
  }
}
    </script>
</body>

</html>